<div class="relative flex h-full min-h-screen w-full flex-col overflow-y-auto pb-24">
  <!-- TopAppBar -->
  <header class="sticky top-0 z-50 flex items-center justify-between bg-white/90 dark:bg-background-dark/90 backdrop-blur-md px-4 py-3 border-b border-gray-200 dark:border-gray-800">
    <div class="flex size-10 items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer text-gray-900 dark:text-white transition-colors" (click)="goBack()" (keydown.enter)="goBack()" tabindex="0" role="button">
      <span class="material-symbols-outlined">arrow_back</span>
    </div>
    <h2 class="text-base font-bold leading-tight flex-1 text-center">Campañas</h2>
    <div class="flex size-10 items-center justify-center rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer text-gray-900 dark:text-white transition-colors" [routerLink]="['/abandoned-cart/campaign/new']">
      <span class="material-symbols-outlined">add</span>
    </div>
  </header>

  <!-- Tabs -->
  <div class="px-4 pt-4 pb-2 border-b border-gray-200 dark:border-gray-800">
    <div class="flex gap-2">
      <button 
        class="px-4 py-2 rounded-lg text-sm font-semibold transition-all"
        [class.bg-primary]="activeTab() === 'active'"
        [class.text-white]="activeTab() === 'active'"
        [class.bg-gray-100]="activeTab() !== 'active'"
        [class.dark:bg-gray-800]="activeTab() !== 'active'"
        [class.text-gray-700]="activeTab() !== 'active'"
        [class.dark:text-gray-300]="activeTab() !== 'active'"
        type="button"
        (click)="activeTab.set('active')">
        Activas
      </button>
      <button 
        class="px-4 py-2 rounded-lg text-sm font-semibold transition-all"
        [class.bg-primary]="activeTab() === 'completed'"
        [class.text-white]="activeTab() === 'completed'"
        [class.bg-gray-100]="activeTab() !== 'completed'"
        [class.dark:bg-gray-800]="activeTab() !== 'completed'"
        [class.text-gray-700]="activeTab() !== 'completed'"
        [class.dark:text-gray-300]="activeTab() !== 'completed'"
        type="button"
        (click)="activeTab.set('completed')">
        Completadas
      </button>
      <button 
        class="px-4 py-2 rounded-lg text-sm font-semibold transition-all"
        [class.bg-primary]="activeTab() === 'draft'"
        [class.text-white]="activeTab() === 'draft'"
        [class.bg-gray-100]="activeTab() !== 'draft'"
        [class.dark:bg-gray-800]="activeTab() !== 'draft'"
        [class.text-gray-700]="activeTab() !== 'draft'"
        [class.dark:text-gray-300]="activeTab() !== 'draft'"
        type="button"
        (click)="activeTab.set('draft')">
        Borradores
      </button>
    </div>
  </div>

  <!-- Campaigns List -->
  <main class="flex-1 px-4 py-4 space-y-4">
    @if (loading()) {
      <div class="flex items-center justify-center py-12">
        <p class="text-gray-500">Cargando campañas...</p>
      </div>
    } @else {
      @for (campaign of getFilteredCampaigns(); track campaign.id) {
        <div class="bg-white dark:bg-gray-800 rounded-xl p-5 shadow-sm border border-gray-100 dark:border-gray-700 hover:shadow-md transition-shadow cursor-pointer" [routerLink]="['/abandoned-cart/campaign', campaign.id, 'results']">
          <!-- Header -->
          <div class="flex items-start justify-between mb-3">
            <div class="flex-1">
              <h3 class="text-lg font-bold text-gray-900 dark:text-white mb-1">{{ campaign.name }}</h3>
              <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium" [ngClass]="getStatusColor(campaign.status)">
                {{ campaign.status === 'ACTIVE' ? 'Activa' : campaign.status === 'COMPLETED' ? 'Completada' : campaign.status === 'DRAFT' ? 'Borrador' : 'Pausada' }}
              </span>
            </div>
            @if (campaign.results) {
              <div class="text-right">
                <p class="text-2xl font-bold text-primary">{{ campaign.results.recoveryRate }}%</p>
                <p class="text-xs text-gray-500">Tasa recuperación</p>
              </div>
            }
          </div>

          <!-- Stats -->
          <div class="grid grid-cols-3 gap-3 mb-4">
            <div>
              <p class="text-xs text-gray-500 mb-1">Audiencia</p>
              <p class="text-sm font-bold text-gray-900 dark:text-white">{{ campaign.audience.count }}</p>
            </div>
            @if (campaign.results) {
              <div>
                <p class="text-xs text-gray-500 mb-1">Enviados</p>
                <p class="text-sm font-bold text-gray-900 dark:text-white">{{ campaign.results.totalSent }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Recuperados</p>
                <p class="text-sm font-bold text-green-600 dark:text-green-400">{{ campaign.results.totalRecovered }}</p>
              </div>
            } @else {
              <div>
                <p class="text-xs text-gray-500 mb-1">Canal</p>
                <p class="text-sm font-bold text-gray-900 dark:text-white">{{ campaign.message.type === 'email' ? 'Email' : 'WhatsApp' }}</p>
              </div>
              <div>
                <p class="text-xs text-gray-500 mb-1">Oferta</p>
                <p class="text-sm font-bold text-primary">{{ campaign.offer?.value }}{{ campaign.offer?.type === 'percentage' ? '%' : '$' }}</p>
              </div>
            }
          </div>

          <!-- Offer Info -->
          @if (campaign.offer) {
            <div class="flex items-center gap-2 p-3 bg-primary/5 dark:bg-primary/10 rounded-lg mb-3">
              <span class="material-symbols-outlined text-primary text-lg">local_offer</span>
              <div class="flex-1">
                <p class="text-xs font-semibold text-gray-700 dark:text-gray-300">Código: {{ campaign.offer.code }}</p>
                <p class="text-[10px] text-gray-500">Expira en {{ campaign.offer.expirationHours }}h</p>
              </div>
            </div>
          }

          <!-- Footer -->
          <div class="flex items-center justify-between text-xs text-gray-500">
            <div class="flex items-center gap-1">
              <span class="material-symbols-outlined text-[14px]">schedule</span>
              @if (campaign.sentAt) {
                <span>Enviado: {{ campaign.sentAt | date:'short' }}</span>
              } @else {
                <span>No enviado</span>
              }
            </div>
            <span class="material-symbols-outlined text-[16px]">chevron_right</span>
          </div>
        </div>
      } @empty {
        <div class="flex flex-col items-center justify-center py-12">
          <span class="material-symbols-outlined text-6xl text-gray-300 dark:text-gray-600 mb-4">campaign</span>
          <p class="text-gray-500 text-center">No hay campañas {{ activeTab() === 'active' ? 'activas' : activeTab() === 'completed' ? 'completadas' : 'en borrador' }}</p>
          <button class="mt-4 px-4 py-2 bg-primary text-white rounded-lg text-sm font-semibold" [routerLink]="['/abandoned-cart/campaign/new']" type="button">
            Crear nueva campaña
          </button>
        </div>
      }
    }
  </main>
</div>


